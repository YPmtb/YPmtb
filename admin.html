<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê³µì§€ì‚¬í•­ ê´€ë¦¬</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header>
        <h1>ê³µì§€ì‚¬í•­ ê´€ë¦¬</h1>
    </header>

    <div class="content">
        <h2>ìƒˆ ê³µì§€ì‚¬í•­ ì¶”ê°€ / ìˆ˜ì •</h2>
        <input type="text" id="noticeTitle" placeholder="ê³µì§€ ì œëª©" class="input-large">
        <textarea id="noticeContent" placeholder="ê³µì§€ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”" class="textarea-large"></textarea>
        
        <!-- ğŸ”¹ ì´ë¯¸ì§€ ì—…ë¡œë“œ ê¸°ëŠ¥ ì¶”ê°€ -->
        <input type="file" id="noticeImage" accept="image/*">
        
        <label>
            <input type="checkbox" id="pinnedNotice"> ìƒë‹¨ ê³ ì •
        </label>
        <button onclick="saveNotice()">ê³µì§€ ì €ì¥</button>

        <h2>ê³µì§€ì‚¬í•­ ëª©ë¡</h2>
        <ul id="noticeList"></ul>
    </div>

    <script>
        let editId = null;

        function loadNotices() {
            const notices = JSON.parse(localStorage.getItem("notices")) || [];
            const noticeList = document.getElementById("noticeList");
            noticeList.innerHTML = "";

            if (notices.length === 0) {
                noticeList.innerHTML = "<li>ë“±ë¡ëœ ê³µì§€ì‚¬í•­ì´ ì—†ìŠµë‹ˆë‹¤.</li>";
                return;
            }

            // ğŸ”¹ ê³µì§€ì‚¬í•­ì„ ìƒë‹¨ ê³ ì • ì—¬ë¶€ + ìµœì‹ ìˆœìœ¼ë¡œ ì •ë ¬
            notices.sort((a, b) => (b.pinned - a.pinned) || (b.id - a.id));

            notices.forEach(notice => {
                const li = document.createElement("li");
                li.innerHTML = `
                    <strong>${notice.pinned ? "ğŸ“Œ " : ""}${notice.title}</strong>
                    <button onclick="editNotice(${notice.id})">ìˆ˜ì •</button>
                    <button onclick="deleteNotice(${notice.id})">ì‚­ì œ</button>
                `;
                noticeList.appendChild(li);
            });

            console.log("ğŸ“¢ ê³µì§€ì‚¬í•­ ëª©ë¡:", notices);
        }

        function saveNotice() {
            const title = document.getElementById("noticeTitle").value;
            const content = document.getElementById("noticeContent").value;
            const isPinned = document.getElementById("pinnedNotice").checked;
            const date = new Date().toLocaleDateString();
            let notices = JSON.parse(localStorage.getItem("notices")) || [];

            // ğŸ”¹ ì´ë¯¸ì§€ íŒŒì¼ ì—…ë¡œë“œ ì²˜ë¦¬
            const fileInput = document.getElementById("noticeImage");
            let imageUrl = "";

            if (fileInput.files.length > 0) {
                const reader = new FileReader();
                reader.onload = function(event) {
                    imageUrl = event.target.result;
                    saveToStorage(title, content, date, isPinned, imageUrl, notices);
                };
                reader.readAsDataURL(fileInput.files[0]);
            } else {
                saveToStorage(title, content, date, isPinned, imageUrl, notices);
            }
        }

        function saveToStorage(title, content, date, isPinned, imageUrl, notices) {
            if (!title || !content) {
                alert("ì œëª©ê³¼ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
                return;
            }

            if (editId) {
                // ê¸°ì¡´ ê³µì§€ ìˆ˜ì •
                notices = notices.map(notice =>
                    notice.id === editId ? { ...notice, title, content, date, pinned: isPinned, image: imageUrl } : notice
                );
                editId = null;
            } else {
                // ìƒˆ ê³µì§€ ì¶”ê°€
                notices.push({ id: Date.now(), title, content, date, pinned: isPinned, image: imageUrl });
            }

            localStorage.setItem("notices", JSON.stringify(notices));
            console.log("âœ… ê³µì§€ì‚¬í•­ ì €ì¥ë¨:", notices);
            alert("ê³µì§€ì‚¬í•­ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.");

            document.getElementById("noticeTitle").value = "";
            document.getElementById("noticeContent").value = "";
            document.getElementById("pinnedNotice").checked = false;
            document.getElementById("noticeImage").value = ""; // íŒŒì¼ ì…ë ¥ ì´ˆê¸°í™”
            loadNotices();
        }

        function editNotice(id) {
            const notices = JSON.parse(localStorage.getItem("notices")) || [];
            const notice = notices.find(n => n.id === id);
            if (!notice) return;

            document.getElementById("noticeTitle").value = notice.title;
            document.getElementById("noticeContent").value = notice.content;
            document.getElementById("pinnedNotice").checked = notice.pinned;
            editId = id;
        }

        function deleteNotice(id) {
            if (!confirm("ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;
            let notices = JSON.parse(localStorage.getItem("notices")) || [];
            notices = notices.filter(notice => notice.id !== id);
            localStorage.setItem("notices", JSON.stringify(notices));
            alert("ê³µì§€ì‚¬í•­ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.");
            loadNotices();
        }

        document.addEventListener("DOMContentLoaded", loadNotices);
    </script>
</body>
</html>
