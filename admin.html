<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>공지사항 관리</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header>
        <h1>공지사항 관리</h1>
    </header>

    <div class="content">
        <h2>새 공지사항 추가 / 수정</h2>
        <input type="text" id="noticeTitle" placeholder="공지 제목" class="input-large">
        <textarea id="noticeContent" placeholder="공지 내용을 입력하세요" class="textarea-large"></textarea>
        
        <!-- 🔹 이미지 업로드 기능 추가 -->
        <input type="file" id="noticeImage" accept="image/*">
        
        <label>
            <input type="checkbox" id="pinnedNotice"> 상단 고정
        </label>
        <button onclick="saveNotice()">공지 저장</button>

        <h2>공지사항 목록</h2>
        <ul id="noticeList"></ul>
    </div>

    <script>
        let editId = null;

        function loadNotices() {
            const notices = JSON.parse(localStorage.getItem("notices")) || [];
            const noticeList = document.getElementById("noticeList");
            noticeList.innerHTML = "";

            if (notices.length === 0) {
                noticeList.innerHTML = "<li>등록된 공지사항이 없습니다.</li>";
                return;
            }

            // 🔹 공지사항을 상단 고정 여부 + 최신순으로 정렬
            notices.sort((a, b) => (b.pinned - a.pinned) || (b.id - a.id));

            notices.forEach(notice => {
                const li = document.createElement("li");
                li.innerHTML = `
                    <strong>${notice.pinned ? "📌 " : ""}${notice.title}</strong>
                    <button onclick="editNotice(${notice.id})">수정</button>
                    <button onclick="deleteNotice(${notice.id})">삭제</button>
                `;
                noticeList.appendChild(li);
            });

            console.log("📢 공지사항 목록:", notices);
        }

        function saveNotice() {
            const title = document.getElementById("noticeTitle").value;
            const content = document.getElementById("noticeContent").value;
            const isPinned = document.getElementById("pinnedNotice").checked;
            const date = new Date().toLocaleDateString();
            let notices = JSON.parse(localStorage.getItem("notices")) || [];

            // 🔹 이미지 파일 업로드 처리
            const fileInput = document.getElementById("noticeImage");
            let imageUrl = "";

            if (fileInput.files.length > 0) {
                const reader = new FileReader();
                reader.onload = function(event) {
                    imageUrl = event.target.result;
                    saveToStorage(title, content, date, isPinned, imageUrl, notices);
                };
                reader.readAsDataURL(fileInput.files[0]);
            } else {
                saveToStorage(title, content, date, isPinned, imageUrl, notices);
            }
        }

        function saveToStorage(title, content, date, isPinned, imageUrl, notices) {
            if (!title || !content) {
                alert("제목과 내용을 입력해주세요.");
                return;
            }

            if (editId) {
                // 기존 공지 수정
                notices = notices.map(notice =>
                    notice.id === editId ? { ...notice, title, content, date, pinned: isPinned, image: imageUrl } : notice
                );
                editId = null;
            } else {
                // 새 공지 추가
                notices.push({ id: Date.now(), title, content, date, pinned: isPinned, image: imageUrl });
            }

            localStorage.setItem("notices", JSON.stringify(notices));
            console.log("✅ 공지사항 저장됨:", notices);
            alert("공지사항이 저장되었습니다.");

            document.getElementById("noticeTitle").value = "";
            document.getElementById("noticeContent").value = "";
            document.getElementById("pinnedNotice").checked = false;
            document.getElementById("noticeImage").value = ""; // 파일 입력 초기화
            loadNotices();
        }

        function editNotice(id) {
            const notices = JSON.parse(localStorage.getItem("notices")) || [];
            const notice = notices.find(n => n.id === id);
            if (!notice) return;

            document.getElementById("noticeTitle").value = notice.title;
            document.getElementById("noticeContent").value = notice.content;
            document.getElementById("pinnedNotice").checked = notice.pinned;
            editId = id;
        }

        function deleteNotice(id) {
            if (!confirm("정말 삭제하시겠습니까?")) return;
            let notices = JSON.parse(localStorage.getItem("notices")) || [];
            notices = notices.filter(notice => notice.id !== id);
            localStorage.setItem("notices", JSON.stringify(notices));
            alert("공지사항이 삭제되었습니다.");
            loadNotices();
        }

        document.addEventListener("DOMContentLoaded", loadNotices);
    </script>
</body>
</html>
